# レジ（請求ファイル自動変換）RPAツール - Google Apps Script版

## 📋 概要

Google Drive上の特定フォルダに格納されたZIPファイルを自動で解凍し、請求ファイルの名前を統一フォーマットに変換するRPAツールです。

## 🚀 主な機能

- **ZIPファイル自動検索**: 指定された年月フォルダ内のZIPファイルを自動検索
- **自動解凍**: ZIPファイルを解凍してPDFファイルを抽出
- **会社名抽出**: 請求情報PDFから会社名を自動抽出
- **ファイル名統一**: 統一フォーマットでファイル名を自動変更
- **自動保存**: 処理済みファイルを「送信データ」フォルダに自動保存

## 📁 ファイル構成

```
gas/
├── Code.gs              # メイン処理コード
├── pdf-processor.gs     # PDF処理モジュール
├── file-renamer.gs      # ファイル名生成・リネーム処理
└── README.md            # このファイル
```

## ⚙️ 設定

### 対象フォルダID
`Code.gs`の`CONFIG.TARGET_FOLDER_ID`を設定してください：

```javascript
const CONFIG = {
  TARGET_FOLDER_ID: '1eGkgviOKRCXuFV1OFLSOI5Ap8F-eeaKr',  // ここを変更
  // ... その他の設定
};
```

### フォルダ構造
以下のような構造を想定しています：

```
対象フォルダ/
├── 2025/
│   ├── 8月/
│   │   ├── ZIPファイル1.zip
│   │   ├── ZIPファイル2.zip
│   │   └── 送信データ/          # 自動作成される
│   └── 9月/
└── 2026/
```

## 🔧 セットアップ手順

### 1. Google Apps Scriptプロジェクトの作成

1. [Google Apps Script](https://script.google.com/)にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「レジ請求ファイル自動変換」などに設定

### 2. コードファイルの作成

1. `Code.gs`の内容をコピーして貼り付け
2. `pdf-processor.gs`の内容をコピーして貼り付け
3. `file-renamer.gs`の内容をコピーして貼り付け

### 3. 設定の確認

1. `Code.gs`の`TARGET_FOLDER_ID`を正しいフォルダIDに変更
2. 対象フォルダがGoogle Driveに存在することを確認

### 4. 権限の設定

初回実行時に以下の権限が必要です：
- Google Driveへのアクセス
- ファイルの作成・編集

## 📖 使用方法

### メイン処理の実行

```javascript
// メイン処理を実行
processInvoices();
```

### 接続テスト

```javascript
// Google Drive接続テスト
testConnection();
```

### 個別処理

```javascript
// PDFから会社名を抽出
const companyName = extractCompanyNameFromPDF(pdfBlob);

// ファイル名を生成
const fileName = generateFileName(2025, 8, '株式会社サンプル', 'bill');
```

## 📊 出力ファイル名フォーマット

### 請求書
```
{年月}_{会社名}様_ご請求書.pdf
例: 202508_株式会社コープファーム様_ご請求書.pdf
```

### 明細書
```
{年月}_{会社名}様_ご請求明細書.pdf
例: 202508_株式会社コープファーム様_ご請求明細書.pdf
```

### 送料明細書
```
{年月}_{会社名}様_ご請求送料明細書.pdf
例: 202508_株式会社コープファーム様_ご請求送料明細書.pdf
```

## 🔍 処理フロー

1. **年月フォルダ検索**: 現在の年月に対応するフォルダを検索
2. **ZIPファイル検索**: 年月フォルダ内のZIPファイルを検索
3. **ZIP解凍**: 各ZIPファイルを解凍してPDFファイルを抽出
4. **会社名抽出**: 請求情報PDFから会社名を抽出
5. **ファイル名生成**: 統一フォーマットでファイル名を生成
6. **ファイル保存**: 「送信データ」フォルダに保存
7. **クリーンアップ**: 一時ファイルを削除

## ⚠️ 注意事項

### PDF処理の制限
- GASでは直接PDFのテキスト抽出が困難
- 現在は簡易的な実装（サンプルテキスト使用）
- 実際の運用では、より高度なPDF処理が必要

### ファイルサイズ制限
- GASにはファイルサイズ制限があります
- 大きなZIPファイルの処理には注意が必要

### 実行時間制限
- GASには実行時間制限があります
- 大量のファイル処理には注意が必要

## 🛠️ カスタマイズ

### ファイルパターンの変更
`CONFIG.SAMPLE_FILE_PATTERNS`を変更することで、ファイル名パターンをカスタマイズできます：

```javascript
SAMPLE_FILE_PATTERNS: {
  BILL: /bill_shipping_\d{14}\.pdf$/,      // 請求書パターン
  DETAIL: /shippingcomp_\d{14}\.pdf$/,     // 明細書パターン
  POSTAGE: /postage_\d{14}\.pdf$/          // 送料明細書パターン
}
```

### 出力フォルダ名の変更
`CONFIG.OUTPUT_FOLDER_NAME`を変更することで、出力フォルダ名をカスタマイズできます：

```javascript
OUTPUT_FOLDER_NAME: '送信データ'  // ここを変更
```

## 🐛 トラブルシューティング

### フォルダが見つからない
- `TARGET_FOLDER_ID`が正しいか確認
- フォルダが削除されていないか確認
- フォルダへのアクセス権限があるか確認

### ファイル処理が失敗する
- ZIPファイルが破損していないか確認
- PDFファイルが正しい形式か確認
- ファイルサイズが制限内か確認

### 権限エラーが発生する
- 初回実行時の権限設定を確認
- Google Driveへのアクセス権限があるか確認

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. エラーメッセージの内容
2. 実行ログの詳細
3. 対象フォルダの状態
4. ファイルの形式・サイズ

## 🔄 更新履歴

- **v1.0.0**: 初回リリース
  - 基本的なZIP処理機能
  - PDFからの会社名抽出
  - ファイル名統一機能
  - 自動保存機能
