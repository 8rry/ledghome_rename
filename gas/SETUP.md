# 🚀 GAS版セットアップ手順書

## 📋 前提条件

- Googleアカウント（Google Driveへのアクセス権限が必要）
- 対象フォルダへのアクセス権限
- 基本的なGoogle Apps Scriptの知識

## 🔧 セットアップ手順

### ステップ1: Google Apps Scriptプロジェクトの作成

1. **Google Apps Scriptにアクセス**
   - ブラウザで [https://script.google.com/](https://script.google.com/) を開く
   - Googleアカウントでログイン

2. **新しいプロジェクトを作成**
   - 「新しいプロジェクト」をクリック
   - プロジェクト名を「レジ請求ファイル自動変換」に設定

3. **プロジェクトの基本設定**
   - プロジェクト名: `レジ請求ファイル自動変換`
   - 説明: `Google Drive上のZIPファイルを自動処理するRPAツール`

### ステップ2: コードファイルの作成

#### 2-1: メインコード（Code.gs）

1. **デフォルトのコードを削除**
   - 既存のコードをすべて削除

2. **Code.gsの内容を貼り付け**
   - `gas/Code.gs`の内容をコピー
   - エディタに貼り付け

3. **設定の確認**
   - `TARGET_FOLDER_ID`が正しいフォルダIDになっているか確認
   - 必要に応じて修正

#### 2-2: PDF処理モジュール（pdf-processor.gs）

1. **新しいファイルを作成**
   - 左側のファイル一覧で「+」をクリック
   - 「スクリプト」を選択
   - ファイル名を「pdf-processor」に設定

2. **コードを貼り付け**
   - `gas/pdf-processor.gs`の内容をコピー
   - エディタに貼り付け

#### 2-3: ファイルリネームモジュール（file-renamer.gs）

1. **新しいファイルを作成**
   - 左側のファイル一覧で「+」をクリック
   - 「スクリプト」を選択
   - ファイル名を「file-renamer」に設定

2. **コードを貼り付け**
   - `gas/file-renamer.gs`の内容をコピー
   - エディタに貼り付け

### ステップ3: 設定の確認

#### 3-1: 対象フォルダIDの確認

1. **Google Driveで対象フォルダを開く**
   - 対象フォルダのURLを確認
   - フォルダIDを抽出（例：`1eGkgviOKRCXuFV1OFLSOI5Ap8F-eeaKr`）

2. **Code.gsの設定を更新**
   ```javascript
   const CONFIG = {
     TARGET_FOLDER_ID: '実際のフォルダID',  // ここを更新
     // ... その他の設定
   };
   ```

#### 3-2: フォルダ構造の確認

対象フォルダが以下の構造になっているか確認：

```
対象フォルダ/
├── 2025/
│   ├── 8月/
│   │   ├── ZIPファイル1.zip
│   │   └── ZIPファイル2.zip
│   └── 9月/
└── 2026/
```

### ステップ4: 権限の設定

#### 4-1: 初回実行時の権限設定

1. **接続テストを実行**
   - エディタで`testConnection`関数を選択
   - 「実行」ボタンをクリック

2. **権限の承認**
   - 「権限が必要です」ダイアログが表示される
   - 「権限を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「安全でないページに移動」をクリック
   - 「許可」をクリック

#### 4-2: 必要な権限

以下の権限が必要です：
- **Google Drive**: ファイルの読み取り・作成・編集
- **Google Apps Script**: スクリプトの実行

### ステップ5: 動作確認

#### 5-1: 接続テスト

1. **接続テストを実行**
   ```javascript
   testConnection();
   ```

2. **結果の確認**
   - 対象フォルダにアクセスできるか
   - フォルダ内のファイル数が正しく表示されるか

#### 5-2: サンプル処理の実行

1. **小規模なテスト**
   - テスト用のZIPファイルを対象フォルダに配置
   - `processInvoices()`を実行

2. **結果の確認**
   - 処理ログが正しく表示されるか
   - 出力フォルダが作成されるか
   - ファイル名が正しく変更されるか

## 🐛 トラブルシューティング

### よくある問題と解決方法

#### 問題1: フォルダが見つからない

**症状**: `File not found`エラーが発生

**原因**: 
- フォルダIDが間違っている
- フォルダが削除されている
- アクセス権限がない

**解決方法**:
1. フォルダIDを再確認
2. Google Driveでフォルダの存在を確認
3. 共有設定を確認

#### 問題2: 権限エラーが発生

**症状**: `権限が必要です`ダイアログが表示される

**原因**: 初回実行時の権限設定が完了していない

**解決方法**:
1. 権限の承認を完了
2. 必要に応じてGoogleアカウントを再選択

#### 問題3: 処理が途中で止まる

**症状**: 処理が完了しない、エラーが発生する

**原因**: 
- ファイルサイズ制限
- 実行時間制限
- ファイルの破損

**解決方法**:
1. ファイルサイズを確認
2. 処理対象を分割
3. ファイルの整合性を確認

## 📚 参考資料

### Google Apps Script公式ドキュメント
- [Google Apps Script ドキュメント](https://developers.google.com/apps-script)
- [DriveApp リファレンス](https://developers.google.com/apps-script/reference/drive)

### 関連するGoogleサービス
- [Google Drive](https://drive.google.com/)
- [Google Workspace](https://workspace.google.com/)

## 🔄 次のステップ

セットアップが完了したら：

1. **本格運用の準備**
   - 大量ファイルでのテスト
   - エラーハンドリングの確認
   - ログ出力の確認

2. **カスタマイズ**
   - ファイルパターンの調整
   - 出力フォルダ名の変更
   - 処理ロジックの最適化

3. **定期実行の設定**
   - 時間ベーストリガーの設定
   - エラー通知の設定
   - 実行ログの管理

## 📞 サポート

問題が発生した場合は：

1. **エラーメッセージを確認**
2. **実行ログを確認**
3. **設定を再確認**
4. **必要に応じて権限を再設定**

セットアップが完了したら、まずは`testConnection()`を実行して動作確認を行ってください！
