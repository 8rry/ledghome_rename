# レジ（請求ファイル自動変換）RPAツール

Google Drive上の特定フォルダに格納されたZIPファイルを自動で解凍し、請求ファイルの名前を統一フォーマットに変換するRPAツールです。

## 🚀 主な機能

- **ZIPファイル自動検索**: 指定された年月フォルダ内のZIPファイルを自動検索
- **自動解凍**: ZIPファイルを解凍してPDFファイルを抽出
- **会社名抽出**: 請求情報PDFから会社名を自動抽出
- **ファイル名統一**: 統一フォーマットでファイル名を自動変更
- **自動保存**: 処理済みファイルを「送信データ」フォルダに自動保存

## 📁 プロジェクト構造

```
rpa_legehome_rename/
├── gas/                    # Google Apps Script版のコード
│   ├── Code.gs            # メイン処理コード
│   ├── pdf-processor.gs   # PDF処理モジュール
│   ├── file-renamer.gs    # ファイル名生成・リネーム処理
│   ├── README.md          # GAS版の使用方法
│   └── SETUP.md           # セットアップ手順書
├── README.md              # このファイル（プロジェクト概要）
└── sample_file/           # サンプルファイル（テスト用）
```

## 🔧 実装方式

### 従来のNode.js版からGAS版に移行

**移行理由**:
- Google Drive APIの認証問題を解決
- 開発・デプロイが簡単
- Google Driveとの完全統合
- 認証情報の管理が不要

**移行完了**:
- ✅ 基本的な処理ロジックをGAS版に移植
- ✅ モジュール化された設計を維持
- ✅ エラーハンドリングとログ出力を実装

## 📊 出力ファイル名フォーマット

### 請求書
```
{年月}_{会社名}様_ご請求書.pdf
例: 202508_株式会社コープファーム様_ご請求書.pdf
```

### 明細書
```
{年月}_{会社名}様_ご請求明細書.pdf
例: 202508_株式会社コープファーム様_ご請求明細書.pdf
```

### 送料明細書
```
{年月}_{会社名}様_ご請求送料明細書.pdf
例: 202508_株式会社コープファーム様_ご請求送料明細書.pdf
```

## 🔍 処理フロー

1. **年月フォルダ検索**: 現在の年月に対応するフォルダを検索
2. **ZIPファイル検索**: 年月フォルダ内のZIPファイルを検索
3. **ZIP解凍**: 各ZIPファイルを解凍してPDFファイルを抽出
4. **会社名抽出**: 請求情報PDFから会社名を抽出
5. **ファイル名生成**: 統一フォーマットでファイル名を生成
6. **ファイル保存**: 「送信データ」フォルダに保存
7. **クリーンアップ**: 一時ファイルを削除

## 🚀 使用方法

### 1. Google Apps Script版を使用（推奨）

詳細な使用方法は `gas/README.md` を参照してください。

**セットアップ手順**:
1. [Google Apps Script](https://script.google.com/)でプロジェクトを作成
2. `gas/` フォルダ内のコードファイルを貼り付け
3. 対象フォルダIDを設定
4. 権限を承認して実行

### 2. セットアップ手順書

詳細なセットアップ手順は `gas/SETUP.md` を参照してください。

## ⚠️ 注意事項

### PDF処理の制限
- GASでは直接PDFのテキスト抽出が困難
- 現在は簡易的な実装（サンプルテキスト使用）
- 実際の運用では、より高度なPDF処理が必要

### ファイルサイズ制限
- GASにはファイルサイズ制限があります
- 大きなZIPファイルの処理には注意が必要

### 実行時間制限
- GASには実行時間制限があります
- 大量のファイル処理には注意が必要

## 🔄 更新履歴

- **v1.0.0**: 初回リリース（Node.js版）
  - Google Drive API連携
  - ZIP処理・PDF処理
  - ファイル名統一機能

- **v2.0.0**: GAS版に移行
  - Google Apps Script版を実装
  - 認証問題を解決
  - 開発効率を向上

## 📞 サポート

問題が発生した場合は：

1. **GAS版の使用方法**: `gas/README.md` を確認
2. **セットアップ手順**: `gas/SETUP.md` を確認
3. **エラーメッセージ**: 実行ログを確認
4. **設定**: 対象フォルダIDと権限を確認

## 🎯 次のステップ

1. **GAS版のセットアップ**: `gas/SETUP.md` の手順に従ってセットアップ
2. **動作確認**: `testConnection()` で接続テスト
3. **本格運用**: `processInvoices()` で処理実行
4. **カスタマイズ**: 必要に応じて設定を調整

---

**注意**: このプロジェクトはNode.js版からGAS版に移行しました。古いNode.js版のコードは削除されています。
