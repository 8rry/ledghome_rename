# レジ（請求ファイル自動変換）RPAツール

Google Drive上の特定フォルダに格納されたZIPファイルを自動で解凍し、請求ファイルの名前を統一フォーマットに変換するRPAツールです。

## 🚀 主な機能

- **ZIPファイル自動検索**: 指定された年月フォルダ内のZIPファイルを自動検索
- **自動解凍**: ZIPファイルを解凍してPDFファイルを抽出
- **会社名抽出**: 請求情報PDFから会社名を自動抽出
- **ファイル名統一**: 統一フォーマットでファイル名を自動変更
- **自動保存**: 処理済みファイルを「送信データ」フォルダに自動保存
- **スプレッドシート連携**: Google Spreadsheetから年月を自動取得

## 📁 プロジェクト構造

```
ledghome_rename/
├── gas/                    # Google Apps Script版のコード
│   ├── Code.gs            # メイン処理コード（統合版）
│   ├── README.md          # GAS版の使用方法
│   └── SETUP.md           # セットアップ手順書
└── README.md              # このファイル（プロジェクト概要）
```

## 🔧 実装方式

### Google Apps Script（GAS）版

**採用理由**:
- Google Drive APIの認証問題を解決
- 開発・デプロイが簡単
- Google Driveとの完全統合
- 認証情報の管理が不要

**実装完了**:
- ✅ 基本的な処理ロジックをGAS版に移植
- ✅ モジュール化された設計を維持
- ✅ エラーハンドリングとログ出力を実装
- ✅ スプレッドシート連携機能を追加

## 📊 出力ファイル名フォーマット

### 請求書
```
{年月}_{会社名}様_ご請求書.pdf
例: 202508_株式会社コープファーム様_ご請求書.pdf
```

### 明細書
```
{年月}_{会社名}様_ご請求明細書.pdf
例: 202508_株式会社コープファーム様_ご請求明細書.pdf
```

### 送料明細書
```
{年月}_{会社名}様_ご請求送料明細書.pdf
例: 202508_株式会社コープファーム様_ご請求送料明細書.pdf
```

## 🔍 処理フロー

1. **スプレッドシートから年月取得**: 指定されたスプレッドシートのA5（年）、C5（月）から処理対象年月を取得
2. **年月フォルダ検索**: 取得した年月に対応するフォルダを検索
3. **ZIPファイル検索**: 年月フォルダ内のZIPファイルを検索
4. **ZIP解凍**: 各ZIPファイルを解凍してPDFファイルを抽出
5. **会社名抽出**: 請求情報PDFから会社名を抽出
6. **ファイル名生成**: 統一フォーマットでファイル名を生成
7. **ファイル保存**: 「送信データ」フォルダに保存

## 🚀 使用方法

### Google Apps Script版を使用

詳細な使用方法は `gas/README.md` を参照してください。

**セットアップ手順**:
1. [Google Apps Script](https://script.google.com/)でプロジェクトを作成
2. `gas/Code.gs` のコードを貼り付け
3. 対象フォルダIDとスプレッドシートIDを設定
4. 権限を承認して実行

### セットアップ手順書

詳細なセットアップ手順は `gas/SETUP.md` を参照してください。

## ⚙️ 設定項目

### 必須設定
- **対象フォルダID**: Google Driveの対象フォルダID
- **スプレッドシートID**: 年月を取得するスプレッドシートのID
- **出力フォルダ名**: 処理済みファイルの保存先フォルダ名（デフォルト: "送信データ"）

### スプレッドシート設定
- **年**: A5セルに数値で入力（例: 2025）
- **月**: C5セルに数値で入力（例: 8）

## ⚠️ 注意事項

### PDF処理の制限
- GASでは直接PDFのテキスト抽出が困難
- 現在は簡易的な実装（サンプルテキスト使用）
- 実際の運用では、より高度なPDF処理が必要

### ファイルサイズ制限
- GASにはファイルサイズ制限があります
- 大きなZIPファイルの処理には注意が必要

### 実行時間制限
- GASには実行時間制限があります
- 大量のファイル処理には注意が必要

## 🔄 更新履歴

- **v1.0.0**: 初回リリース（Node.js版）
  - Google Drive API連携
  - ZIP処理・PDF処理
  - ファイル名統一機能

- **v2.0.0**: GAS版に移行
  - Google Apps Script版を実装
  - 認証問題を解決
  - 開発効率を向上

- **v2.1.0**: スプレッドシート連携機能追加
  - 年月の自動取得機能
  - 設定の一元化
  - 運用効率の向上

## 📞 サポート

問題が発生した場合は：

1. **GAS版の使用方法**: `gas/README.md` を確認
2. **セットアップ手順**: `gas/SETUP.md` を確認
3. **エラーメッセージ**: 実行ログを確認
4. **設定**: 対象フォルダID、スプレッドシートID、権限を確認

## 🎯 次のステップ

1. **GAS版のセットアップ**: `gas/SETUP.md` の手順に従ってセットアップ
2. **スプレッドシートの設定**: 年月をA5、C5セルに設定
3. **動作確認**: `testConnection()` で接続テスト
4. **本格運用**: `processInvoices()` で処理実行
5. **カスタマイズ**: 必要に応じて設定を調整

---

**注意**: このプロジェクトはNode.js版からGAS版に完全移行し、スプレッドシート連携機能も追加されました。古いNode.js版のコードは削除されています。
